<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Upgrade | Laravel Spark</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,800,800i,900,900i" rel="stylesheet" type="text/css">
    <link rel="apple-touch-icon" sizes="180x180" href="/docs/assets/img/apple-touch-icon.png?v=00aYpBgAp5">
    <link rel="icon" type="image/png" sizes="32x32" href="/docs/assets/img/favicon-32x32.png?v=00aYpBgAp5">
    <link rel="icon" type="image/png" sizes="16x16" href="/docs/assets/img/favicon-16x16.png?v=00aYpBgAp5">
    <link rel="shortcut icon" href="/docs/assets/img/favicon.ico?v=00aYpBgAp5">
    <meta name="description" content="A perfect starting point for your next great idea.">
    <meta name="docsearch:version" content="2.x.x">
    <meta name="theme-color" content="#ffffff">
    <link rel="preload" href="/docs/assets/css/0.styles.0cced51f.css" as="style"><link rel="preload" href="/docs/assets/js/app.cc5ac1d4.js" as="script"><link rel="preload" href="/docs/assets/js/2.4e486a52.js" as="script"><link rel="preload" href="/docs/assets/js/47.ca441ac5.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.e4095c38.js"><link rel="prefetch" href="/docs/assets/js/11.a7ad27b7.js"><link rel="prefetch" href="/docs/assets/js/12.b0cb3065.js"><link rel="prefetch" href="/docs/assets/js/13.bae66e7c.js"><link rel="prefetch" href="/docs/assets/js/14.b878794d.js"><link rel="prefetch" href="/docs/assets/js/15.76ce8f29.js"><link rel="prefetch" href="/docs/assets/js/16.0f0c668c.js"><link rel="prefetch" href="/docs/assets/js/17.f10dabca.js"><link rel="prefetch" href="/docs/assets/js/18.82fee3db.js"><link rel="prefetch" href="/docs/assets/js/19.96e8c273.js"><link rel="prefetch" href="/docs/assets/js/20.cb190e3a.js"><link rel="prefetch" href="/docs/assets/js/21.f21ce387.js"><link rel="prefetch" href="/docs/assets/js/22.da9953ec.js"><link rel="prefetch" href="/docs/assets/js/23.34a9bb6a.js"><link rel="prefetch" href="/docs/assets/js/24.3d46e784.js"><link rel="prefetch" href="/docs/assets/js/25.fd5fafba.js"><link rel="prefetch" href="/docs/assets/js/26.4c272ff3.js"><link rel="prefetch" href="/docs/assets/js/27.bc8eb9d5.js"><link rel="prefetch" href="/docs/assets/js/28.51abbb18.js"><link rel="prefetch" href="/docs/assets/js/29.5aefc26a.js"><link rel="prefetch" href="/docs/assets/js/3.1d9a54a8.js"><link rel="prefetch" href="/docs/assets/js/30.f7f88489.js"><link rel="prefetch" href="/docs/assets/js/31.62d7e026.js"><link rel="prefetch" href="/docs/assets/js/32.4bd45eee.js"><link rel="prefetch" href="/docs/assets/js/33.a4c10e29.js"><link rel="prefetch" href="/docs/assets/js/34.89816a24.js"><link rel="prefetch" href="/docs/assets/js/35.230ab9e5.js"><link rel="prefetch" href="/docs/assets/js/36.85327b50.js"><link rel="prefetch" href="/docs/assets/js/37.739993e4.js"><link rel="prefetch" href="/docs/assets/js/38.347e5d3c.js"><link rel="prefetch" href="/docs/assets/js/39.73034f40.js"><link rel="prefetch" href="/docs/assets/js/4.ea9308ca.js"><link rel="prefetch" href="/docs/assets/js/40.833672e4.js"><link rel="prefetch" href="/docs/assets/js/41.503aee52.js"><link rel="prefetch" href="/docs/assets/js/42.4e6edfee.js"><link rel="prefetch" href="/docs/assets/js/43.2de2ea24.js"><link rel="prefetch" href="/docs/assets/js/44.0609ef37.js"><link rel="prefetch" href="/docs/assets/js/45.22b7c9a6.js"><link rel="prefetch" href="/docs/assets/js/46.04242596.js"><link rel="prefetch" href="/docs/assets/js/48.038e7c32.js"><link rel="prefetch" href="/docs/assets/js/49.c49838f6.js"><link rel="prefetch" href="/docs/assets/js/5.afed23da.js"><link rel="prefetch" href="/docs/assets/js/6.b8e434ac.js"><link rel="prefetch" href="/docs/assets/js/7.e980edd8.js"><link rel="prefetch" href="/docs/assets/js/8.fcdb9b7c.js"><link rel="prefetch" href="/docs/assets/js/9.1fadc020.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.0cced51f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/assets/img/logo.svg" alt="Laravel Spark" class="logo"> <span class="site-name can-hide">Laravel Spark</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://spark.laravel.com" target="_self" class="nav-link external">
  Home
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Version" class="dropdown-title"><span class="title">Version</span> <span class="arrow down"></span></button> <button type="button" aria-label="Version" class="mobile-dropdown-title"><span class="title">Version</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/1.x/" class="nav-link">
  1.x
</a></li><li class="dropdown-item"><!----> <a href="/docs/2.x/" class="nav-link router-link-active">
  2.x
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://spark.laravel.com" target="_self" class="nav-link external">
  Home
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Version" class="dropdown-title"><span class="title">Version</span> <span class="arrow down"></span></button> <button type="button" aria-label="Version" class="mobile-dropdown-title"><span class="title">Version</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/1.x/" class="nav-link">
  1.x
</a></li><li class="dropdown-item"><!----> <a href="/docs/2.x/" class="nav-link router-link-active">
  2.x
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/2.x/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/docs/2.x/installation.html" class="sidebar-link">Installation</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Spark Paddle</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/2.x/spark-paddle/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/docs/2.x/spark-paddle/plans.html" class="sidebar-link">Plans</a></li><li><a href="/docs/2.x/spark-paddle/middleware.html" class="sidebar-link">Middleware</a></li><li><a href="/docs/2.x/spark-paddle/events.html" class="sidebar-link">Events</a></li><li><a href="/docs/2.x/spark-paddle/testing.html" class="sidebar-link">Testing</a></li><li><a href="/docs/2.x/spark-paddle/cookbook.html" class="sidebar-link">Cookbook</a></li><li><a href="/docs/2.x/spark-paddle/customization.html" class="sidebar-link">Customization</a></li><li><a href="/docs/2.x/spark-paddle/upgrade.html" class="sidebar-link">Upgrade</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Spark Stripe</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/2.x/spark-stripe/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/docs/2.x/spark-stripe/plans.html" class="sidebar-link">Plans</a></li><li><a href="/docs/2.x/spark-stripe/middleware.html" class="sidebar-link">Middleware</a></li><li><a href="/docs/2.x/spark-stripe/taxes.html" class="sidebar-link">Taxes</a></li><li><a href="/docs/2.x/spark-stripe/events.html" class="sidebar-link">Events</a></li><li><a href="/docs/2.x/spark-stripe/testing.html" class="sidebar-link">Testing</a></li><li><a href="/docs/2.x/spark-stripe/cookbook.html" class="sidebar-link">Cookbook</a></li><li><a href="/docs/2.x/spark-stripe/customization.html" class="sidebar-link">Customization</a></li><li><a href="/docs/2.x/spark-stripe/upgrade.html" aria-current="page" class="active sidebar-link">Upgrade</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="upgrade"><a href="#upgrade" class="header-anchor">#</a> Upgrade</h1> <p></p><div class="table-of-contents"><ul><li><a href="#upgrading-to-spark-stripe-2-0-from-1-x">Upgrading to Spark (Stripe) 2.0 From 1.x</a><ul><li><a href="#minimum-versions">Minimum Versions</a></li><li><a href="#stripe-api-version">Stripe API Version</a></li><li><a href="#vatcalculator-3-x">VatCalculator 3.x</a></li><li><a href="#renaming-plans-to-prices">Renaming &quot;Plans&quot; To Prices</a></li><li><a href="#new-payment-methods-support">New Payment Methods Support</a></li><li><a href="#stripe-product-support">Stripe Product Support</a></li></ul></li><li><a href="#upgrading-to-spark-stripe-v1-0-5">Upgrading To Spark (Stripe) v1.0.5</a></li></ul></div><p></p> <h2 id="upgrading-to-spark-stripe-2-0-from-1-x"><a href="#upgrading-to-spark-stripe-2-0-from-1-x" class="header-anchor">#</a> Upgrading to Spark (Stripe) 2.0 From 1.x</h2> <p>Spark (Stripe) 2.0 primarily provides an upgrade from Cashier 12.x to Cashier 13.x. As such, in addition to the upgrade guide below, please consult the <a href="https://github.com/laravel/cashier-stripe/blob/13.x/UPGRADE.md" target="_blank" rel="noopener noreferrer">Cashier 13 upgrade guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="minimum-versions"><a href="#minimum-versions" class="header-anchor">#</a> Minimum Versions</h3> <p>The following required dependency versions have been updated:</p> <ul><li>The minimum Cashier Stripe version is now v13.0</li> <li>The minimum Laravel version is now v9.0</li> <li>The minimum PHP version is now v8.0</li> <li>The minimum Stripe SDK version is now v7.39</li> <li>The minimum VatCalculator version is now v3.0</li></ul> <h3 id="stripe-api-version"><a href="#stripe-api-version" class="header-anchor">#</a> Stripe API Version</h3> <p>The default Stripe API version for Cashier 13.x is <code>2020-08-27</code>.</p> <p>If you use the Stripe SDK directly, make sure to properly test your integration after updating.</p> <h4 id="upgrading-your-stripe-webhook"><a href="#upgrading-your-stripe-webhook" class="header-anchor">#</a> Upgrading Your Stripe Webhook</h4> <p>You should ensure your Stripe webhook operates on the same API version as Spark's underlying API version used by Cashier. To do so, you may use the <code>cashier:webhook</code> command from your production environment to create a new webhook that matches Cashier's Stripe API version:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan cashier:webhook --disabled
</code></pre></div><p>This will create a new webhook with the same Stripe API version as Cashier <a href="https://dashboard.stripe.com/webhooks" target="_blank" rel="noopener noreferrer">in your Stripe dashboard<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. The webhook will be immediately disabled so it doesn't interfere with your existing production application until you are ready to enable it. By default, the webhook will be created using the <code>APP_URL</code> environment variable to determine the proper URL for your application. If you need to use a different URL, you can use the <code>--url</code> flag when invoking the command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan cashier:webhook --disabled --url <span class="token string">&quot;http://example.com/spark/webhook&quot;</span>
</code></pre></div><p>You may use the following upgrade checklist to properly enable to the new webhook:</p> <ol><li>If you have webhook signature verification enabled, disable it on production by temporarily removing the <code>STRIPE_WEBHOOK_SECRET</code> environment variable.</li> <li>Add any extra Stripe events your application requires to the new webhook in your Stripe dashboard.</li> <li>Disable the old webhook in your Stripe dashboard.</li> <li>Enable the new webhook in your Stripe dashboard.</li> <li>Re-enable the new webhook secret by re-adding the <code>STRIPE_WEBHOOK_SECRET</code> environment variable in production with the secret from the new webhook.</li> <li>Remove the old webhook in your Stripe dashboard.</li></ol> <p>After following this process, your new webhook will be active and ready to receive events.</p> <h3 id="vatcalculator-3-x"><a href="#vatcalculator-3-x" class="header-anchor">#</a> VatCalculator 3.x</h3> <p>The <a href="https://github.com/driesvints/vat-calculator" target="_blank" rel="noopener noreferrer">VatCalculator<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> package utilized by Spark has been upgraded to its latest major version. While we do not anticipate any breaking changes from this upgrade, you might want to review this package's <a href="https://github.com/driesvints/vat-calculator/blob/3.x/UPGRADE.md" target="_blank" rel="noopener noreferrer">upgrade guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, specifically the section on <a href="https://github.com/driesvints/vat-calculator/blob/3.x/UPGRADE.md#removed-countries" target="_blank" rel="noopener noreferrer">removed countries<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="renaming-plans-to-prices"><a href="#renaming-plans-to-prices" class="header-anchor">#</a> Renaming &quot;Plans&quot; To Prices</h3> <p>To accommodate Stripe's phasing out of the &quot;Plans&quot; API, we've made the choice to partially migrate away from the &quot;Plans&quot; terminology. Because of this, the <code>stripe_plan</code> columns on the <code>subscriptions</code> and <code>subscription_items</code> tables have been renamed to <code>stripe_price</code>.  You will need to write a migration to rename these columns:</p> <div class="language-php extra-class"><pre class="language-php"><code>Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'subscriptions'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Blueprint <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">renameColumn</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'stripe_plan'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'stripe_price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'subscription_items'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Blueprint <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">renameColumn</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'stripe_plan'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'stripe_price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Running this migration requires you to <a href="https://laravel.com/docs/migrations#renaming-columns" target="_blank" rel="noopener noreferrer">install the <code>doctrine/dbal</code> package<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="new-payment-methods-support"><a href="#new-payment-methods-support" class="header-anchor">#</a> New Payment Methods Support</h3> <p>Cashier v13 supports new payment methods. Because of this, the <code>card</code> columns in the database have been renamed to accommodate for all types of payment methods. You will need to write a migration to rename the billable model table's <code>card_brand</code>, <code>card_last_four</code> and <code>card_expiration</code> columns accordingly:</p> <div class="language-php extra-class"><pre class="language-php"><code>Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Blueprint <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">renameColumn</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'card_brand'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'pm_type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">renameColumn</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'card_last_four'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'pm_last_four'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">renameColumn</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'card_expiration'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'pm_expiration'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Running this migration requires you to <a href="https://laravel.com/docs/migrations#renaming-columns" target="_blank" rel="noopener noreferrer">install the <code>doctrine/dbal</code> package<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="stripe-product-support"><a href="#stripe-product-support" class="header-anchor">#</a> Stripe Product Support</h3> <p>PR: https://github.com/laravel/cashier-stripe/pull/1185</p> <p>Cashier Stripe v13 includes support for inspecting Stripe Product identifiers. To provide support for this feature, a new <code>stripe_product</code> column should be added to the <code>subscription_items</code> table:</p> <div class="language-php extra-class"><pre class="language-php"><code>Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'subscription_items'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Blueprint <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'stripe_product'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">nullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'stripe_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you would like to make use of the new <code>onProduct</code> &amp; <code>subscribedToProduct</code> methods on your billable model, you should ensure the records in the <code>subscription_items</code> have their <code>stripe_product</code> column filled with the correct Product ID from Stripe.</p> <h2 id="upgrading-to-spark-stripe-v1-0-5"><a href="#upgrading-to-spark-stripe-v1-0-5" class="header-anchor">#</a> Upgrading To Spark (Stripe) v1.0.5</h2> <h4 id="updating-the-configuration-file"><a href="#updating-the-configuration-file" class="header-anchor">#</a> Updating The Configuration File</h4> <p>Spark (Stripe) v1.0.5 introduces a new format for enabling features in the configuration file. To use the new format, add the following lines to your <code>config/spark.php</code> configuration file:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Spark<span class="token punctuation">\</span>Features</span><span class="token punctuation">;</span>

<span class="token single-quoted-string string">'features'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token comment">// Features::euVatCollection(['home-country' =&gt; 'BE']),</span>
    <span class="token comment">// Features::receiptEmails(['custom-addresses' =&gt; true]),</span>
    Features<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">paymentNotificationEmails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>Next, uncomment the features you want to use in your application and remove the old corresponding configuration keys:</p> <ul><li><code>collects_eu_vat</code></li> <li><code>sends_receipt_emails</code></li> <li><code>sends_payment_notification_emails</code></li></ul> <h4 id="collecting-billing-email-addresses"><a href="#collecting-billing-email-addresses" class="header-anchor">#</a> Collecting Billing Email Addresses</h4> <p>Spark (Stripe) 1.0.5 introduces the ability to email receipts to a custom billing address that the customer provides. This is typically used to email receipts directly to an accountant.</p> <p>To support this feature, you need to create a new migration in your application and add the following schema modification in the migration's <code>up()</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">hasColumn</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'receipt_emails'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Blueprint <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'receipt_emails'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'stripe_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Make sure to run the migration against the table that corresponds to your billable model.</p> <p>To enable the feature, uncomment the <code>Features::receiptEmails()</code> line in your <code>config/spark.php</code> configuration file:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'features'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token comment">// Features::euVatCollection(['home-country' =&gt; 'BE']),</span>
    Features<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">receiptEmails</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'custom-addresses'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean constant">true</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Features<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">paymentNotificationEmailsSending</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/2.x/spark-stripe/customization.html" class="prev">
        Customization
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.cc5ac1d4.js" defer></script><script src="/docs/assets/js/2.4e486a52.js" defer></script><script src="/docs/assets/js/47.ca441ac5.js" defer></script>
  </body>
</html>
