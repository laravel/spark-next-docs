<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Upgrade | Laravel Spark</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,800,800i,900,900i" rel="stylesheet" type="text/css">
    <link rel="apple-touch-icon" sizes="180x180" href="/docs/assets/img/apple-touch-icon.png?v=00aYpBgAp5">
    <link rel="icon" type="image/png" sizes="32x32" href="/docs/assets/img/favicon-32x32.png?v=00aYpBgAp5">
    <link rel="icon" type="image/png" sizes="16x16" href="/docs/assets/img/favicon-16x16.png?v=00aYpBgAp5">
    <link rel="shortcut icon" href="/docs/assets/img/favicon.ico?v=00aYpBgAp5">
    <meta name="description" content="A perfect starting point for your next great idea.">
    <meta name="docsearch:version" content="2.x.x">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/docs/assets/css/0.styles.c0c886bb.css" as="style"><link rel="preload" href="/docs/assets/js/app.11ed9a59.js" as="script"><link rel="preload" href="/docs/assets/js/2.e25629a7.js" as="script"><link rel="preload" href="/docs/assets/js/49.72f352fe.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.abc10df8.js"><link rel="prefetch" href="/docs/assets/js/11.d3fb8cd8.js"><link rel="prefetch" href="/docs/assets/js/12.965072a7.js"><link rel="prefetch" href="/docs/assets/js/13.0129f984.js"><link rel="prefetch" href="/docs/assets/js/14.9861b6e9.js"><link rel="prefetch" href="/docs/assets/js/15.be446089.js"><link rel="prefetch" href="/docs/assets/js/16.10ef0c2b.js"><link rel="prefetch" href="/docs/assets/js/17.f62f4989.js"><link rel="prefetch" href="/docs/assets/js/18.be1ab332.js"><link rel="prefetch" href="/docs/assets/js/19.bdc35da2.js"><link rel="prefetch" href="/docs/assets/js/20.362f0961.js"><link rel="prefetch" href="/docs/assets/js/21.bce379e0.js"><link rel="prefetch" href="/docs/assets/js/22.db9640d4.js"><link rel="prefetch" href="/docs/assets/js/23.c2854556.js"><link rel="prefetch" href="/docs/assets/js/24.9d499e01.js"><link rel="prefetch" href="/docs/assets/js/25.541847d5.js"><link rel="prefetch" href="/docs/assets/js/26.430b678b.js"><link rel="prefetch" href="/docs/assets/js/27.8c143919.js"><link rel="prefetch" href="/docs/assets/js/28.6d604f65.js"><link rel="prefetch" href="/docs/assets/js/29.30eaa49c.js"><link rel="prefetch" href="/docs/assets/js/3.dc71ae3d.js"><link rel="prefetch" href="/docs/assets/js/30.d6a51d12.js"><link rel="prefetch" href="/docs/assets/js/31.ca23de3b.js"><link rel="prefetch" href="/docs/assets/js/32.ae3bd69f.js"><link rel="prefetch" href="/docs/assets/js/33.f9d561f1.js"><link rel="prefetch" href="/docs/assets/js/34.e782e342.js"><link rel="prefetch" href="/docs/assets/js/35.a8d7ec98.js"><link rel="prefetch" href="/docs/assets/js/36.8b19ceee.js"><link rel="prefetch" href="/docs/assets/js/37.829330a4.js"><link rel="prefetch" href="/docs/assets/js/38.7b295400.js"><link rel="prefetch" href="/docs/assets/js/39.861bb7ce.js"><link rel="prefetch" href="/docs/assets/js/4.5f6bfe57.js"><link rel="prefetch" href="/docs/assets/js/40.93dc2c6e.js"><link rel="prefetch" href="/docs/assets/js/41.f6cd3bbc.js"><link rel="prefetch" href="/docs/assets/js/42.a58ddc7a.js"><link rel="prefetch" href="/docs/assets/js/43.5b6d9fba.js"><link rel="prefetch" href="/docs/assets/js/44.82a3622b.js"><link rel="prefetch" href="/docs/assets/js/45.1ad8fcd1.js"><link rel="prefetch" href="/docs/assets/js/46.4c3e9d67.js"><link rel="prefetch" href="/docs/assets/js/47.8b9e9a5d.js"><link rel="prefetch" href="/docs/assets/js/48.38168e03.js"><link rel="prefetch" href="/docs/assets/js/5.9e9fc063.js"><link rel="prefetch" href="/docs/assets/js/50.a45b7f9f.js"><link rel="prefetch" href="/docs/assets/js/51.ca79f3f4.js"><link rel="prefetch" href="/docs/assets/js/6.78edb7c1.js"><link rel="prefetch" href="/docs/assets/js/7.ba3c63d4.js"><link rel="prefetch" href="/docs/assets/js/8.8cfb42ff.js"><link rel="prefetch" href="/docs/assets/js/9.a9356660.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.c0c886bb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/assets/img/logo.svg" alt="Laravel Spark" class="logo"> <span class="site-name can-hide">Laravel Spark</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://spark.laravel.com" target="_self" class="nav-link external">
  Home
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Version" class="dropdown-title"><span class="title">Version</span> <span class="arrow down"></span></button> <button type="button" aria-label="Version" class="mobile-dropdown-title"><span class="title">Version</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/1.x/" class="nav-link">
  1.x
</a></li><li class="dropdown-item"><!----> <a href="/docs/2.x/" class="nav-link router-link-active">
  2.x
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://spark.laravel.com" target="_self" class="nav-link external">
  Home
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Version" class="dropdown-title"><span class="title">Version</span> <span class="arrow down"></span></button> <button type="button" aria-label="Version" class="mobile-dropdown-title"><span class="title">Version</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/1.x/" class="nav-link">
  1.x
</a></li><li class="dropdown-item"><!----> <a href="/docs/2.x/" class="nav-link router-link-active">
  2.x
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/2.x/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/docs/2.x/installation.html" class="sidebar-link">Installation</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Spark Paddle</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/2.x/spark-paddle/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/docs/2.x/spark-paddle/plans.html" class="sidebar-link">Plans</a></li><li><a href="/docs/2.x/spark-paddle/middleware.html" class="sidebar-link">Middleware</a></li><li><a href="/docs/2.x/spark-paddle/events.html" class="sidebar-link">Events</a></li><li><a href="/docs/2.x/spark-paddle/testing.html" class="sidebar-link">Testing</a></li><li><a href="/docs/2.x/spark-paddle/cookbook.html" class="sidebar-link">Cookbook</a></li><li><a href="/docs/2.x/spark-paddle/customization.html" class="sidebar-link">Customization</a></li><li><a href="/docs/2.x/spark-paddle/upgrade.html" class="sidebar-link">Upgrade</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Spark Stripe</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/2.x/spark-stripe/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/docs/2.x/spark-stripe/plans.html" class="sidebar-link">Plans</a></li><li><a href="/docs/2.x/spark-stripe/middleware.html" class="sidebar-link">Middleware</a></li><li><a href="/docs/2.x/spark-stripe/taxes.html" class="sidebar-link">Taxes</a></li><li><a href="/docs/2.x/spark-stripe/events.html" class="sidebar-link">Events</a></li><li><a href="/docs/2.x/spark-stripe/testing.html" class="sidebar-link">Testing</a></li><li><a href="/docs/2.x/spark-stripe/cookbook.html" class="sidebar-link">Cookbook</a></li><li><a href="/docs/2.x/spark-stripe/customization.html" class="sidebar-link">Customization</a></li><li><a href="/docs/2.x/spark-stripe/upgrade.html" aria-current="page" class="active sidebar-link">Upgrade</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="upgrade"><a href="#upgrade" class="header-anchor">#</a> Upgrade</h1> <p></p><div class="table-of-contents"><ul><li><a href="#upgrading-to-spark-stripe-v2-0-from-v1-x">Upgrading to Spark-Stripe v2.0 From v1.x</a><ul><li><a href="#minimum-versions">Minimum Versions</a></li><li><a href="#stripe-api-version">Stripe API Version</a></li><li><a href="#renaming-plans-to-prices">Renaming &quot;Plans&quot; To Prices</a></li><li><a href="#new-payment-methods-support">New Payment Methods Support</a></li><li><a href="#stripe-product-support">Stripe Product Support</a></li></ul></li><li><a href="#upgrading-to-spark-stripe-v1-0-5">Upgrading to Spark-Stripe v1.0.5</a></li></ul></div><p></p> <h2 id="upgrading-to-spark-stripe-v2-0-from-v1-x"><a href="#upgrading-to-spark-stripe-v2-0-from-v1-x" class="header-anchor">#</a> Upgrading to Spark-Stripe v2.0 From v1.x</h2> <p>In addition to the upgrade guide below, please reference <a href="https://github.com/laravel/cashier-stripe/blob/13.x/UPGRADE.md" target="_blank" rel="noopener noreferrer">the Cashier v13 upgrade guide <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>as well.</p> <h3 id="minimum-versions"><a href="#minimum-versions" class="header-anchor">#</a> Minimum Versions</h3> <p>The following required dependency versions have been updated:</p> <ul><li>The minimum Cashier Stripe version is now v13.0</li> <li>The minimum Laravel version is now v9.0</li> <li>The minimum PHP version is now v8.0</li> <li>The minimum Stripe SDK version is now v7.39</li></ul> <h3 id="stripe-api-version"><a href="#stripe-api-version" class="header-anchor">#</a> Stripe API Version</h3> <p>The default Stripe API version for Cashier 13.x will be <code>2020-08-27</code>. If this is the latest Stripe API version at the time that you're upgrading to this Cashier version then it's also recommended that you upgrade your own Stripe API version settings <a href="https://dashboard.stripe.com/developers" target="_blank" rel="noopener noreferrer">in your Stripe dashboard<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to this version after deploying the Cashier upgrade. If this is no longer the latest Stripe API version, we recommend you do not modify your Stripe API version settings.</p> <p>If you use the Stripe SDK directly, make sure to properly test your integration after updating.</p> <h4 id="upgrading-your-webhook"><a href="#upgrading-your-webhook" class="header-anchor">#</a> Upgrading Your Webhook</h4> <p>You should ensure your webhook operates on the same API version as Cashier. To do so, you may use the <code>cashier:webhook</code> command from your production environment to create a new webhook that matches Cashier's Stripe API version:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan cashier:webhook --disabled
</code></pre></div><p>This will create a new webhook with the same Stripe API version as Cashier <a href="https://dashboard.stripe.com/webhooks" target="_blank" rel="noopener noreferrer">in your Stripe dashboard<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The webhook will be immediately disabled so it doesn't interfere with your existing production application until you are ready to enable it. By default, the webhook will be created using the <code>APP_URL</code> environment variable to determine the proper URL for your application. If you need to use a different URL, you can use the <code>--url</code> flag when invoking the command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan cashier:webhook --disabled --url <span class="token string">&quot;http://example.com/spark/webhook&quot;</span>
</code></pre></div><p>You may use the following upgrade checklist to properly enable to the new webhook:</p> <ol><li>If you have webhook signature verification enabled, disable it on production by temporarily removing the <code>STRIPE_WEBHOOK_SECRET</code> environment variable.</li> <li>Add any extra Stripe events your application requires to the new webhook in your Stripe dashboard.</li> <li>Disable the old webhook in your Stripe dashboard.</li> <li>Enable the new webhook in your Stripe dashboard.</li> <li>Re-enable the new webhook secret by re-adding the <code>STRIPE_WEBHOOK_SECRET</code> environment variable in production with the secret from the new webhook.</li> <li>Remove the old webhook in your Stripe dashboard.</li></ol> <p>After following this process, your new webhook will be active and ready to receive events.</p> <h3 id="renaming-plans-to-prices"><a href="#renaming-plans-to-prices" class="header-anchor">#</a> Renaming &quot;Plans&quot; To Prices</h3> <p>To accommodate Stripe's phasing out of the &quot;Plans&quot; API, we've made the choice to partially migrate away from the &quot;Plans&quot; terminology. Because of this, the <code>stripe_plan</code> columns on the <code>subscriptions</code> and <code>subscription_items</code> tables have been renamed to <code>stripe_price</code>.  You will need to write a migration to rename these columns:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'subscriptions'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Blueprint</span> <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">renameColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'stripe_plan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'stripe_price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'subscription_items'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Blueprint</span> <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">renameColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'stripe_plan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'stripe_price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Running this migration requires you to <a href="https://laravel.com/docs/migrations#renaming-columns" target="_blank" rel="noopener noreferrer">install the <code>doctrine/dbal</code> package<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="new-payment-methods-support"><a href="#new-payment-methods-support" class="header-anchor">#</a> New Payment Methods Support</h3> <p>Cashier v13 supports new payment methods. Because of this, the <code>card</code> columns in the database have been renamed to accommodate for all types of payment methods. You will need to write a migration to rename the billable model table's <code>card_brand</code>, <code>card_last_four</code> and <code>card_expiration</code> columns accordingly:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Blueprint</span> <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">renameColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'card_brand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pm_type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">renameColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'card_last_four'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pm_last_four'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">renameColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'card_expiration'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pm_expiration'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Running this migration requires you to <a href="https://laravel.com/docs/migrations#renaming-columns" target="_blank" rel="noopener noreferrer">install the <code>doctrine/dbal</code> package<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="stripe-product-support"><a href="#stripe-product-support" class="header-anchor">#</a> Stripe Product Support</h3> <p>PR: https://github.com/laravel/cashier-stripe/pull/1185</p> <p>Cashier Stripe v13 comes with support for checking Stripe Product identifiers. To provide support for this feature, a new <code>stripe_product</code> column should be added to the <code>subscription_items</code> table:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'subscription_items'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Blueprint</span> <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'stripe_product'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">nullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'stripe_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you'd like to make use of the new <code>onProduct</code> &amp; <code>subscribedToProduct</code> methods on your billable model, you should ensure the records in the <code>subscription_items</code> have their <code>stripe_product</code> column filled with the correct Product ID from Stripe.</p> <h2 id="upgrading-to-spark-stripe-v1-0-5"><a href="#upgrading-to-spark-stripe-v1-0-5" class="header-anchor">#</a> Upgrading to Spark-Stripe v1.0.5</h2> <h4 id="updating-the-configuration-file"><a href="#updating-the-configuration-file" class="header-anchor">#</a> Updating The Configuration File</h4> <p>Spark-Stripe v1.0.5 introduces a new format for enabling features in the configuration file. To use the new format, add the following lines to your <code>config/spark.php</code> configuration file:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Spark<span class="token punctuation">\</span>Features</span><span class="token punctuation">;</span>

<span class="token string single-quoted-string">'features'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token comment">// Features::euVatCollection(['home-country' =&gt; 'BE']),</span>
    <span class="token comment">// Features::receiptEmails(['custom-addresses' =&gt; true]),</span>
    <span class="token class-name static-context">Features</span><span class="token operator">::</span><span class="token function">paymentNotificationEmails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>Next, uncomment the features you want to use in your application and remove the old corresponding configuration keys:</p> <ul><li><code>collects_eu_vat</code></li> <li><code>sends_receipt_emails</code></li> <li><code>sends_payment_notification_emails</code></li></ul> <h4 id="collecting-billing-email-addresses"><a href="#collecting-billing-email-addresses" class="header-anchor">#</a> Collecting Billing Email Addresses</h4> <p>Spark-Stripe v1.0.5 introduces the ability to email receipts to a custom billing address that the customer provides. This is typically used to email receipts directly to an accountant.</p> <p>To support this feature, you need to create a new migration in your application and add the following schema modification in the migration's <code>up()</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">hasColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'receipt_emails'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Blueprint</span> <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'receipt_emails'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'stripe_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Make sure to run the migration against the table that corresponds to your billable model.</p> <p>To enable the feature, uncomment the <code>Features::receiptEmails()</code> line in your <code>config/spark.php</code> configuration file:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token string single-quoted-string">'features'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token comment">// Features::euVatCollection(['home-country' =&gt; 'BE']),</span>
    <span class="token class-name static-context">Features</span><span class="token operator">::</span><span class="token function">receiptEmails</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'custom-addresses'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name static-context">Features</span><span class="token operator">::</span><span class="token function">paymentNotificationEmailsSending</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/2.x/spark-stripe/customization.html" class="prev">
        Customization
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.11ed9a59.js" defer></script><script src="/docs/assets/js/2.e25629a7.js" defer></script><script src="/docs/assets/js/49.72f352fe.js" defer></script>
  </body>
</html>
