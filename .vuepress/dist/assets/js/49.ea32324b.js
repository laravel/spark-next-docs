(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{447:function(t,s,a){"use strict";a.r(s);var e=a(55),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"upgrade"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#upgrade"}},[t._v("#")]),t._v(" Upgrade")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#upgrading-to-spark-stripe-v2-0-from-v1-x"}},[t._v("Upgrading to Spark-Stripe v2.0 From v1.x")]),a("ul",[a("li",[a("a",{attrs:{href:"#minimum-versions"}},[t._v("Minimum Versions")])]),a("li",[a("a",{attrs:{href:"#stripe-api-version"}},[t._v("Stripe API Version")])]),a("li",[a("a",{attrs:{href:"#renaming-plans-to-prices"}},[t._v('Renaming "Plans" To Prices')])]),a("li",[a("a",{attrs:{href:"#new-payment-methods-support"}},[t._v("New Payment Methods Support")])]),a("li",[a("a",{attrs:{href:"#stripe-product-support"}},[t._v("Stripe Product Support")])])])]),a("li",[a("a",{attrs:{href:"#upgrading-to-spark-stripe-v1-0-5"}},[t._v("Upgrading to Spark-Stripe v1.0.5")])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"upgrading-to-spark-stripe-v2-0-from-v1-x"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#upgrading-to-spark-stripe-v2-0-from-v1-x"}},[t._v("#")]),t._v(" Upgrading to Spark-Stripe v2.0 From v1.x")]),t._v(" "),a("p",[t._v("In addition to the upgrade guide below, please reference "),a("a",{attrs:{href:"https://github.com/laravel/cashier-stripe/blob/13.x/UPGRADE.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("the Cashier v13 upgrade guide "),a("OutboundLink")],1),t._v("as well.")]),t._v(" "),a("h3",{attrs:{id:"minimum-versions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#minimum-versions"}},[t._v("#")]),t._v(" Minimum Versions")]),t._v(" "),a("p",[t._v("The following required dependency versions have been updated:")]),t._v(" "),a("ul",[a("li",[t._v("The minimum Cashier Stripe version is now v13.0")]),t._v(" "),a("li",[t._v("The minimum Laravel version is now v9.0")]),t._v(" "),a("li",[t._v("The minimum PHP version is now v8.0")]),t._v(" "),a("li",[t._v("The minimum Stripe SDK version is now v7.39")])]),t._v(" "),a("h3",{attrs:{id:"stripe-api-version"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#stripe-api-version"}},[t._v("#")]),t._v(" Stripe API Version")]),t._v(" "),a("p",[t._v("The default Stripe API version for Cashier 13.x will be "),a("code",[t._v("2020-08-27")]),t._v(". If this is the latest Stripe API version at the time that you're upgrading to this Cashier version then it's also recommended that you upgrade your own Stripe API version settings "),a("a",{attrs:{href:"https://dashboard.stripe.com/developers",target:"_blank",rel:"noopener noreferrer"}},[t._v("in your Stripe dashboard"),a("OutboundLink")],1),t._v(" to this version after deploying the Cashier upgrade. If this is no longer the latest Stripe API version, we recommend you do not modify your Stripe API version settings.")]),t._v(" "),a("p",[t._v("If you use the Stripe SDK directly, make sure to properly test your integration after updating.")]),t._v(" "),a("h4",{attrs:{id:"upgrading-your-webhook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#upgrading-your-webhook"}},[t._v("#")]),t._v(" Upgrading Your Webhook")]),t._v(" "),a("p",[t._v("You should ensure your webhook operates on the same API version as Cashier. To do so, you may use the "),a("code",[t._v("cashier:webhook")]),t._v(" command from your production environment to create a new webhook that matches Cashier's Stripe API version:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("php artisan cashier:webhook --disabled\n")])])]),a("p",[t._v("This will create a new webhook with the same Stripe API version as Cashier "),a("a",{attrs:{href:"https://dashboard.stripe.com/webhooks",target:"_blank",rel:"noopener noreferrer"}},[t._v("in your Stripe dashboard"),a("OutboundLink")],1),t._v(". The webhook will be immediately disabled so it doesn't interfere with your existing production application until you are ready to enable it. By default, the webhook will be created using the "),a("code",[t._v("APP_URL")]),t._v(" environment variable to determine the proper URL for your application. If you need to use a different URL, you can use the "),a("code",[t._v("--url")]),t._v(" flag when invoking the command:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("php artisan cashier:webhook --disabled --url "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://example.com/spark/webhook"')]),t._v("\n")])])]),a("p",[t._v("You may use the following upgrade checklist to properly enable to the new webhook:")]),t._v(" "),a("ol",[a("li",[t._v("If you have webhook signature verification enabled, disable it on production by temporarily removing the "),a("code",[t._v("STRIPE_WEBHOOK_SECRET")]),t._v(" environment variable.")]),t._v(" "),a("li",[t._v("Add any extra Stripe events your application requires to the new webhook in your Stripe dashboard.")]),t._v(" "),a("li",[t._v("Disable the old webhook in your Stripe dashboard.")]),t._v(" "),a("li",[t._v("Enable the new webhook in your Stripe dashboard.")]),t._v(" "),a("li",[t._v("Re-enable the new webhook secret by re-adding the "),a("code",[t._v("STRIPE_WEBHOOK_SECRET")]),t._v(" environment variable in production with the secret from the new webhook.")]),t._v(" "),a("li",[t._v("Remove the old webhook in your Stripe dashboard.")])]),t._v(" "),a("p",[t._v("After following this process, your new webhook will be active and ready to receive events.")]),t._v(" "),a("h3",{attrs:{id:"renaming-plans-to-prices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#renaming-plans-to-prices"}},[t._v("#")]),t._v(' Renaming "Plans" To Prices')]),t._v(" "),a("p",[t._v('To accommodate Stripe\'s phasing out of the "Plans" API, we\'ve made the choice to partially migrate away from the "Plans" terminology. Because of this, the '),a("code",[t._v("stripe_plan")]),t._v(" columns on the "),a("code",[t._v("subscriptions")]),t._v(" and "),a("code",[t._v("subscription_items")]),t._v(" tables have been renamed to "),a("code",[t._v("stripe_price")]),t._v(".  You will need to write a migration to rename these columns:")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Schema")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'subscriptions'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name type-declaration"}},[t._v("Blueprint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$table")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renameColumn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'stripe_plan'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'stripe_price'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Schema")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'subscription_items'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name type-declaration"}},[t._v("Blueprint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$table")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renameColumn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'stripe_plan'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'stripe_price'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("Running this migration requires you to "),a("a",{attrs:{href:"https://laravel.com/docs/migrations#renaming-columns",target:"_blank",rel:"noopener noreferrer"}},[t._v("install the "),a("code",[t._v("doctrine/dbal")]),t._v(" package"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h3",{attrs:{id:"new-payment-methods-support"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#new-payment-methods-support"}},[t._v("#")]),t._v(" New Payment Methods Support")]),t._v(" "),a("p",[t._v("Cashier v13 supports new payment methods. Because of this, the "),a("code",[t._v("card")]),t._v(" columns in the database have been renamed to accommodate for all types of payment methods. You will need to write a migration to rename the billable model table's "),a("code",[t._v("card_brand")]),t._v(", "),a("code",[t._v("card_last_four")]),t._v(" and "),a("code",[t._v("card_expiration")]),t._v(" columns accordingly:")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Schema")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'users'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name type-declaration"}},[t._v("Blueprint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$table")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renameColumn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'card_brand'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'pm_type'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$table")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renameColumn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'card_last_four'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'pm_last_four'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$table")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renameColumn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'card_expiration'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'pm_expiration'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("Running this migration requires you to "),a("a",{attrs:{href:"https://laravel.com/docs/migrations#renaming-columns",target:"_blank",rel:"noopener noreferrer"}},[t._v("install the "),a("code",[t._v("doctrine/dbal")]),t._v(" package"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h3",{attrs:{id:"stripe-product-support"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#stripe-product-support"}},[t._v("#")]),t._v(" Stripe Product Support")]),t._v(" "),a("p",[t._v("PR: https://github.com/laravel/cashier-stripe/pull/1185")]),t._v(" "),a("p",[t._v("Cashier Stripe v13 comes with support for checking Stripe Product identifiers. To provide support for this feature, a new "),a("code",[t._v("stripe_product")]),t._v(" column should be added to the "),a("code",[t._v("subscription_items")]),t._v(" table:")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Schema")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'subscription_items'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name type-declaration"}},[t._v("Blueprint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$table")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token keyword type-declaration"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'stripe_product'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nullable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("after")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'stripe_id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("If you'd like to make use of the new "),a("code",[t._v("onProduct")]),t._v(" & "),a("code",[t._v("subscribedToProduct")]),t._v(" methods on your billable model, you should ensure the records in the "),a("code",[t._v("subscription_items")]),t._v(" have their "),a("code",[t._v("stripe_product")]),t._v(" column filled with the correct Product ID from Stripe.")]),t._v(" "),a("h2",{attrs:{id:"upgrading-to-spark-stripe-v1-0-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#upgrading-to-spark-stripe-v1-0-5"}},[t._v("#")]),t._v(" Upgrading to Spark-Stripe v1.0.5")]),t._v(" "),a("h4",{attrs:{id:"updating-the-configuration-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#updating-the-configuration-file"}},[t._v("#")]),t._v(" Updating The Configuration File")]),t._v(" "),a("p",[t._v("Spark-Stripe v1.0.5 introduces a new format for enabling features in the configuration file. To use the new format, add the following lines to your "),a("code",[t._v("config/spark.php")]),t._v(" configuration file:")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[t._v("Spark"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Features")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'features'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Features::euVatCollection(['home-country' => 'BE']),")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Features::receiptEmails(['custom-addresses' => true]),")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Features")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("paymentNotificationEmails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),a("p",[t._v("Next, uncomment the features you want to use in your application and remove the old corresponding configuration keys:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("collects_eu_vat")])]),t._v(" "),a("li",[a("code",[t._v("sends_receipt_emails")])]),t._v(" "),a("li",[a("code",[t._v("sends_payment_notification_emails")])])]),t._v(" "),a("h4",{attrs:{id:"collecting-billing-email-addresses"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#collecting-billing-email-addresses"}},[t._v("#")]),t._v(" Collecting Billing Email Addresses")]),t._v(" "),a("p",[t._v("Spark-Stripe v1.0.5 introduces the ability to email receipts to a custom billing address that the customer provides. This is typically used to email receipts directly to an accountant.")]),t._v(" "),a("p",[t._v("To support this feature, you need to create a new migration in your application and add the following schema modification in the migration's "),a("code",[t._v("up()")]),t._v(" method:")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("up")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Schema")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasColumn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'users'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'receipt_emails'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Schema")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'users'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name type-declaration"}},[t._v("Blueprint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$table")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("text")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'receipt_emails'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("after")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'stripe_id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Make sure to run the migration against the table that corresponds to your billable model.")]),t._v(" "),a("p",[t._v("To enable the feature, uncomment the "),a("code",[t._v("Features::receiptEmails()")]),t._v(" line in your "),a("code",[t._v("config/spark.php")]),t._v(" configuration file:")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'features'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Features::euVatCollection(['home-country' => 'BE']),")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Features")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("receiptEmails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'custom-addresses'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Features")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("paymentNotificationEmailsSending")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);